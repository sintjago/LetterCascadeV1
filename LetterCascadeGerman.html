<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buchstaben-Kaskade</title>
  <style>
    body {
      background-color: white;
      color: black;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    #gameContainer {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    canvas {
      background-color: #000;
      width: 100%;
      height: 420px;
      border: 2px solid #888;
      display: block;
      margin: 20px auto 10px;
    }

    #infoBar {
      margin-top: 10px;
      font-size: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .box-preview {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: #f8f8f8;
      border: 2px solid black;
      border-radius: 4px;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin: 20px 0 10px;
    }

    .label {
      font-weight: bold;
      margin-right: 4px;
    }

    select, button {
      padding: 8px;
      font-size: 16px;
      border: 2px solid #888;
      border-radius: 4px;
      background-color: #f0f0f0;
      cursor: pointer;
    }

    .color-button {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid #FFF;
      cursor: pointer;
      margin: 0 4px;
      display: inline-block;
    }

    #colorSchemes {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }

    #styleLabel {
      font-weight: bold;
      margin-right: 8px;
    }

    .key {
      display: inline-block;
      padding: 8px 12px;
      margin: 3px;
      border: 1px solid #fff;
      border-radius: 5px;
      cursor: pointer;
      background-color: #666;
      color: white;
      font-size: 16px;
    }

    .key:hover {
      background-color: #555;
    }

    #pauseMessage {
      display: none;
      font-size: 2em;
      color: white;
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-shadow: 2px 2px 4px #000;
    }

    @media (max-width: 600px) {
      #controls {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="420"></canvas>

    <div id="infoBar">
      <strong>Buchstaben-Kaskade</strong> |
      Punktzahl: <span id="score">0</span> |
      Leben: <span id="lives">5</span> (20 Buchstaben = +1 Leben)
      <input type="checkbox" id="borderToggle" checked />
      <div class="box-preview"></div>
    </div>

    <div id="controls">
      <span class="label">Schriftart:</span>
      <select id="fontSelect">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Impact">Impact</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Trebuchet MS">Trebuchet MS</option>
        <option value="Verdana">Verdana</option>
        <option value="Comic Sans MS">Comic Sans</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Lucida Console">Lucida Console</option>
        <option value="Garamond">Garamond</option>
        <option value="Papyrus">Papyrus</option>
        <option value="Palatino">Palatino</option>
        <option value="Arial Black">Arial Black</option>
        <option value="Lucida Sans">Lucida Sans</option>
        <option value="Copperplate">Copperplate</option>
        <option value="Didot" selected>Didot</option>
        <option value="Gill Sans">Gill Sans</option>
        <option value="Rockwell">Rockwell</option>
        <option value="Century Gothic">Century Gothic</option>
        <option value="Scramble">Scramble</option>
      </select>

      <label><input type="checkbox" id="highlightToggle" checked> Hervorheben</label>
      <button id="startGame">Start</button>
      <button id="resetGame">ZurÃ¼cksetzen</button>

      <span class="label">Geschwindigkeit:</span>
      <select id="speed">
        <option value="1">&gt;1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>

      <button id="soundToggle">ðŸ”Š</button>
    </div>

    <div id="colorSchemes">
      <span id="styleLabel">Stil:</span>
      <span class="color-button" style="background-color: white; border-color: black;" onclick="setColorScheme('neutral')"></span>
      <span class="color-button" style="background-color: #00274C; border-color: #FFCB05;" onclick="setColorScheme('umichMaize')"></span>
      <span class="color-button" style="background-color: #FFCB05; border-color: #00274C;" onclick="setColorScheme('umichBlue')"></span>
      <span class="color-button" style="background-color: #121212;" onclick="setColorScheme('dark')"></span>
      <span class="color-button" style="background-color: #FDFD96;" onclick="setColorScheme('pastel')"></span>
      <span class="color-button" style="background-color: #39FF14;" onclick="setColorScheme('neon')"></span>
      <span class="color-button" style="background-color: #002B36;" onclick="setColorScheme('solarized')"></span>
      <span class="color-button" style="background-color: #228B22;" onclick="setColorScheme('forest')"></span>
      <span class="color-button" style="background-color: #0077BE;" onclick="setColorScheme('ocean')"></span>
      <span class="color-button" style="background-color: #FF4500;" onclick="setColorScheme('sunset')"></span>
      <span class="color-button" style="background-color: #8B008B;" onclick="setColorScheme('berry')"></span>
      <span class="color-button" style="background-color: #191970;" onclick="setColorScheme('midnight')"></span>
    </div>

    <div id="keyboard">
      <div id="languageKeys"></div>
    </div>

    <div id="pauseMessage">Spiel pausiert<br />DrÃ¼cke Leertaste zum Fortfahren</div>
  </div>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreElement = document.getElementById("score");
const livesElement = document.getElementById("lives");
const startButton = document.getElementById("startGame");
const resetButton = document.getElementById("resetGame");
const fontSelect = document.getElementById("fontSelect");
const highlightToggle = document.getElementById("highlightToggle");
const speedSelector = document.getElementById("speed");
const keyboardContainer = document.getElementById("languageKeys");
const pauseMessage = document.getElementById("pauseMessage");
const soundToggle = document.getElementById("soundToggle");
const borderToggle = document.getElementById("borderToggle");

const tastatur = [
  ["A", "B", "C", "D", "E", "F", "G", "H", "I"],
  ["J", "K", "L", "M", "N", "O", "P", "Q", "R"],
  ["S", "T", "U", "V", "W", "X", "Y", "Z", "Ã„", "Ã–", "Ãœ", "ÃŸ"]
];

const schriftarten = [...fontSelect.options].map(opt => opt.value);
const farbenHell = ["#FF4C4C", "#FFD700", "#00FA9A", "#1E90FF", "#FF69B4"];
const farbenDunkel = ["#222222", "#004080", "#800000", "#3A3A3A", "#0B3D91"];

let punkte = 0;
let leben = 5;
let buchstaben = [];
let pausiert = false;
let eingabePause = false;
let spielGestartet = false;
let tonAn = true;
let richtigeTreffer = 0;
const BUCHSTABEN_PRO_LEBEN = 20;

const farbschemas = {
  neutral: { bgColor: 'white', textColor: 'black', borderColor: '#888' },
  umichMaize: { bgColor: '#00274C', textColor: '#FFCB05', borderColor: '#FFCB05' },
  umichBlue: { bgColor: '#FFCB05', textColor: '#00274C', borderColor: '#00274C' },
  dark: { bgColor: '#121212', textColor: '#E0E0E0', borderColor: '#BB86FC' },
  pastel: { bgColor: '#FDFD96', textColor: '#63474D', borderColor: '#A8E6CF' },
  neon: { bgColor: '#39FF14', textColor: '#FF1493', borderColor: '#9400D3' },
  solarized: { bgColor: '#002B36', textColor: '#839496', borderColor: '#268BD2' },
  forest: { bgColor: '#228B22', textColor: '#F5FFFA', borderColor: '#2E8B57' },
  ocean: { bgColor: '#0077BE', textColor: '#FFFFFF', borderColor: '#00BFFF' },
  sunset: { bgColor: '#FF4500', textColor: '#FFE4B5', borderColor: '#FF6347' },
  berry: { bgColor: '#8B008B', textColor: '#FFC0CB', borderColor: '#C71585' },
  midnight: { bgColor: '#191970', textColor: '#F8F8FF', borderColor: '#1E90FF' }
};

function setColorScheme(name) {
  const scheme = farbschemas[name];
  document.body.style.backgroundColor = scheme.bgColor;
  document.body.style.color = scheme.textColor;
  canvas.style.borderColor = scheme.borderColor;
}
setColorScheme('neutral');

function geschwindigkeitAnpassen(basis) {
  const faktor = parseInt(speedSelector.value) || 3;
  return basis * (faktor / 4);
}

function zufallsFarbe() {
  return borderToggle.checked
    ? farbenDunkel[Math.floor(Math.random() * farbenDunkel.length)]
    : farbenHell[Math.floor(Math.random() * farbenHell.length)];
}

function buchstabeErstellen() {
  const alle = tastatur.flat();
  const buchstabe = alle[Math.floor(Math.random() * alle.length)];
  const x = Math.random() * (canvas.width - 60) + 30;
  const y = 0;
  const geschw = geschwindigkeitAnpassen(1 + Math.random() * 2);
  const farbe = zufallsFarbe();
  return { buchstabe, x, y, geschw, farbe };
}

function buchstabenInitialisieren() {
  buchstaben = [];
  for (let i = 0; i < 5; i++) buchstaben.push(buchstabeErstellen());
}

function buchstabenZeichnen() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (const b of buchstaben) {
    const schrift = fontSelect.value === "Scramble"
      ? schriftarten[Math.floor(Math.random() * schriftarten.length)]
      : fontSelect.value;
    ctx.font = `30px ${schrift}`;
    ctx.textAlign = "center";

    const w = 70, h = 40;
    const x = b.x - w / 2;
    const y = b.y - 30;

    if (borderToggle.checked) {
      ctx.fillStyle = "#f8f8f8";
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(x, y, w, h, 10);
      ctx.fill();
      ctx.stroke();
    }

    ctx.fillStyle = b.farbe;
    if (highlightToggle.checked || !borderToggle.checked) {
      ctx.shadowColor = borderToggle.checked ? "rgba(255,255,255,0.5)" : "yellow";
      ctx.shadowBlur = borderToggle.checked ? 10 : 15;
    } else {
      ctx.shadowColor = "transparent";
      ctx.shadowBlur = 0;
    }

    ctx.fillText(b.buchstabe, b.x, b.y);
  }
}

if (!CanvasRenderingContext2D.prototype.roundRect) {
  CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
    this.beginPath();
    this.moveTo(x + r, y);
    this.arcTo(x + w, y, x + w, y + h, r);
    this.arcTo(x + w, y + h, x, y + h, r);
    this.arcTo(x, y + h, x, y, r);
    this.arcTo(x, y, x + w, y, r);
    this.closePath();
  };
}

function buchstabenAktualisieren() {
  for (const b of buchstaben) {
    b.y += b.geschw;
    if (b.y > canvas.height) {
      leben--;
      buchstaben.splice(buchstaben.indexOf(b), 1);
      buchstaben.push(buchstabeErstellen());
      scoreAktualisieren();
      if (leben <= 0) {
        alert('Spiel beendet! Endpunktzahl: ' + punkte);
        spielZurÃ¼cksetzen();
      }
    }
  }
}

async function eingabeVerarbeiten(eingabe) {
  const index = buchstaben.findIndex(b => b.buchstabe.toUpperCase() === eingabe.toUpperCase());
  if (index !== -1) {
    const b = buchstaben[index];
    buchstaben.splice(index, 1);
    buchstaben.push(buchstabeErstellen());
    eingabePause = true;
    if (tonAn) await buchstabeSprechen(b.buchstabe);
    eingabePause = false;
    punkte += 10;
    richtigeTreffer++;
    if (richtigeTreffer % BUCHSTABEN_PRO_LEBEN === 0) leben++;
    scoreAktualisieren();
  }
}

function scoreAktualisieren() {
  scoreElement.textContent = punkte;
  livesElement.textContent = leben;
}

function spielZurÃ¼cksetzen() {
  punkte = 0;
  leben = 5;
  richtigeTreffer = 0;
  spielGestartet = false;
  buchstaben = [];
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  scoreAktualisieren();
  tastaturErstellen();
}

function buchstabeSprechen(buchstabe) {
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(buchstabe);
    u.lang = 'de-DE';
    u.onend = resolve;
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(u), 100);
  });
}

function tastaturErstellen() {
  keyboardContainer.innerHTML = '';
  for (const zeile of tastatur) {
    const zeileDiv = document.createElement("div");
    for (const b of zeile) {
      const taste = document.createElement("div");
      taste.className = "key";
      taste.textContent = b;
      taste.onclick = () => eingabeVerarbeiten(b);
      zeileDiv.appendChild(taste);
    }
    keyboardContainer.appendChild(zeileDiv);
  }
}

startButton.onclick = () => {
  if (!spielGestartet) {
    buchstabenInitialisieren();
    spielGestartet = true;
    tastaturErstellen();
  }
};

resetButton.onclick = spielZurÃ¼cksetzen;

soundToggle.onclick = () => {
  tonAn = !tonAn;
  soundToggle.textContent = tonAn ? 'ðŸ”Š' : 'ðŸ”‡';
};

document.addEventListener('keydown', e => {
  if (spielGestartet && !eingabePause) eingabeVerarbeiten(e.key);
  if (e.code === 'Space') {
    pausiert = !pausiert;
    pauseMessage.style.display = pausiert ? 'block' : 'none';
  }
});

function spielSchleife() {
  if (spielGestartet && !pausiert && !eingabePause) {
    buchstabenZeichnen();
    buchstabenAktualisieren();
  }
  requestAnimationFrame(spielSchleife);
}
spielSchleife();
</script>
</body>
</html>
